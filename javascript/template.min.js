/*! DNA Template | (c) Daniel Sevcik | MIT License | https://github.com/webdevelopers-eu/dna-template */
window.dnaTemplate=function(){class Tokenizer extends Array{operatorChars=["!","=","<",">","~","|","&"];quoteChars=["'",'"'];blockChars={"{":"}","[":"]","(":")"};hardSeparatorChars=[","];softSeparatorChars=[" ","\t","\r","\n"];input;pointer=0;constructor(e){super(),this.input=(e||"")+""}tokenize(){for(;!this.endOfInput();){var e=this.tokenizeUntil();if(null===e)break;this.push(e)}}endOfInput(){return this.pointer>=this.input.length}next(){return this.endOfInput()?null:this.input[this.pointer++]}prev(){return this.pointer<=0?null:this.input[--this.pointer]}tokenizeUntil(t=","){var a=new Tokenizer(this.input);let r={type:"command",value:""},o=!1;for(let e=this.next();null!==e;e=this.next())if(o||"text"==r.type&&e!=r.delimiter)r.value+=e,o=!1;else if("\\"===e)o=!0;else if("text"==r.type&&e==r.delimiter)this.pushSmart(a,r),r={type:"command",value:""};else{if(e===t)break;e in this.blockChars?(this.pushSmart(a,r),a.push({type:"block",value:this.tokenizeUntil(this.blockChars[e]),start:e,end:this.blockChars[e]}),r={type:"command",value:""}):this.quoteChars.includes(e)?(this.pushSmart(a,r),r={type:"text",value:"",delimiter:e}):"command"==r.type&&this.hardSeparatorChars.includes(e)?(this.pushSmart(a,r),this.pushSmart(a,{type:"separator",value:e}),r={type:"command",value:""}):"command"==r.type&&this.softSeparatorChars.includes(e)?(this.pushSmart(a,r),r={type:"command",value:""}):"operator"!==r.type&&this.operatorChars.includes(e)?(this.pushSmart(a,r),r={type:"operator",value:e}):"operator"!==r.type||this.operatorChars.includes(e)?r.value+=e:(this.pushSmart(a,r),r={type:"command",value:""},this.prev())}return this.pushSmart(a,r),a}pushSmart(e,t){if("command"==t.type){if(t.value=t.value.trim(),!t.value.length)return;isNaN(t.value)||(t.type="text",t.value=new Number(t.value))}e.push(t)}}function tokenize(e){e=new Tokenizer(e);return e.tokenize(),e}class Evaluator{vars;tokens;targetShortcuts={"@*":"attr",":*":"event",".*":"class","+":"html",".":"text","=":"value","?":"toggle","!":"remove"};operatorsCompare=["==","!=",">",">=","<","<="];operatorsBoolean=["!","&&","||"];data={negate:!1,condition:null,keyword:"",target:null,param:null,value:null};constructor(e){this.tokens=e,this.normalize()}normalize(){var e=Array.from(this.tokens);let t=this.nextToken(e,["operator","command","block"]);"operator"===t.type&&"!"===t.value&&(this.data.negate=!0,t=this.nextToken(e,["command","block"])),this.data.condition=t;var a=(t=this.nextToken(e,["command"])).value.substr(0,1)+(1<t.value.length?"*":"");if(void 0!==this.targetShortcuts[a])switch(this.data.keyword=this.targetShortcuts[a],this.data.keyword){case"attr":case"event":e.unshift({type:"block",value:[{type:"command",value:t.value.substr(1)}]});break;case"class":e.unshift({type:"text",value:t.value.substr(1).replace(/\./g," ")})}else{if(!this.targetShortcuts.values().includes(t.value))throw new Error(`Invalid keyword: ${t.value} . Supported keywords: `+Object.keys(this.targetShortcuts).join(", "));this.data.keyword=t.value}(t=this.nextToken(e,["block","text","command",null]))&&("block"===t.type&&(this.data.target=t.value[0].value,t=this.nextToken(e,["text","command",null])),t)&&("text"===t.type?this.data.value=t.value:"command"===t.type&&(this.data.value=t))}getVariableValue(e){return void 0!==this.vars[e]?this.vars[e]:null}evaluate(e){if("object"!=typeof e)throw new Error(`The variables must be an object. Current argument: ${typeof e}.`);this.vars=e;var t={...this.data};switch(null===t.value&&"command"==t.condition.type?t.value=this.toValue(t.condition):"object"==typeof t.value&&(t.value=this.toValue(t.value)),t.condition.type){case"block":t.condition=!!this.evaluateBlock(t.condition.value);break;case"command":t.condition=!!this.evaluateVariable(t.condition.value)}return t.negate&&(t.condition=!t.condition),t}evaluateVariable(e){e=this.getVariableValue(e);return null===e?null:this.isEmpty(e)}isEmpty(e){return!("object"==typeof e&&(e.constructor!==Object||0!==Object.keys(e).length)||Number.isFinite(e)&&0===e||!e)}evaluateBlock(tokens){const expression=this.mkExpression(tokens);return console.log("expression",expression),eval(expression)}mkExpression(e){let t="";for(;;){var a=this.nextToken(e,["command","block","text","operator",null]);if(!a)break;if(1<e.length&&"operator"===e[0].type&&this.operatorsCompare.includes(e[0].value)){var r=this.nextToken(e,["operator"]),o=this.nextToken(e,["command","text"]);t+=this.compare(a,r,o)?1:0}else switch(a.type){case"operator":if(!this.operatorsBoolean.includes(a.value))throw new Error(`Invalid operator: ${a.value}. Supported operators: `+this.operatorsBoolean.join(", "));t+=a.value;break;case"block":t+=this.mkExpression(a.value);break;case"command":t+=this.evaluateVariable(a.value)?1:0;break;case"text":t+=this.isEmpty(a.value)?1:0}}return"("+(t||"0")+")"}toValue(e){let t;switch(e.type){case"command":t=this.getVariableValue(e.value);break;case"text":t=e.value;break;case"block":t=this.evaluateBlock(e.value);break;default:throw new Error(`Invalid token type: ${e.type} (value: ${JSON.stringify(e)}).`)}var a=Number(t);return isNaN(a)?t:a}compare(e,t,a){var r=this.toValue(e),o=this.toValue(a);switch(t.value){case"==":return r===o?1:0;case"!=":return r!==o?1:0;case"<":return r<o?1:0;case"<=":return r<=o?1:0;case">":return o<r?1:0;case">=":return o<=r?1:0;default:throw new Error(`Invalid operator: ${t.value} . Supported operators: `+this.operatorsCompare.join(", "))}}nextToken(e,t=[]){e=e.shift();if(t.includes(e?e.type:null))return e;throw new Error(`Invalid z-var value: (${e.type}) "${e.value}". Command or block expected: "${this.tokens.input}"`)}}function evaluate(e,t){return new Evaluator(e).evaluate(t)}class Template{rootElement=null;vars=null;scopeLevel=0;scopeSelector="*[@template or (@template-scope and @template-scope != 'inherit')]";zElementSelector="*[@z-var]";scopeLevelSelector=`count(ancestor-or-self::${this.scopeSelector})`;constructor(e){if(!(e instanceof Element))throw new Error("DnaTemplate accepts an instance of HTMLElement as constructor argument");this.rootElement=e,this.scopeLevel=this.query(this.scopeLevelSelector,e)}render(e){this.vars=e;var t=this.query(`descendant-or-self::${this.zElementSelector}[${this.scopeLevelSelector} = ${this.scopeLevel}]`);console.log("found",t);for(let e=0;e<t.length;e++)this.processZElement(t[e])}processZElement(t){const a=t.getAttribute("z-var");var e=tokenize(a);Array.from(e).map(e=>evaluate(e,this.vars)).forEach(e=>console.log("zVar",e,a,t))}query(e,t=null){var a=this.rootElement.ownerDocument.evaluate(e,t||this.rootElement,null,XPathResult.ANY_TYPE,null);switch(a.resultType){case XPathResult.NUMBER_TYPE:return a.numberValue;case XPathResult.STRING_TYPE:return a.stringValue;case XPathResult.BOOLEAN_TYPE:return a.booleanValue;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:for(var r,o=[];r=a.iterateNext();o.push(r));return o}}}function dnaTemplate(e,t){return new Template(e instanceof Document?e.documentElement:e).render(t)}return dnaTemplate}(),"undefined"!=typeof jQuery&&(jQuery.fn.template=function(a){return this.each((e,t)=>dnaTemplate(t,a)),this});
//# sourceMappingURL=template.min.js.map