/*! DNA Template | (c) Daniel Sevcik | MIT License | https://github.com/webdevelopers-eu/dna-template */
window.dnaTemplate=function(){class Tokenizer extends Array{operatorChars=["!","=","<",">","~","|","&"];quoteChars=["'",'"'];blockChars={"{":"}","[":"]","(":")"};hardSeparatorChars=[","];softSeparatorChars=[" ","\t","\r","\n"];input;pointer=0;constructor(e){super(),this.input=(e||"")+""}tokenize(){for(;!this.endOfInput();){var e=this.tokenizeUntil();if(null===e)break;this.push(e)}}endOfInput(){return this.pointer>=this.input.length}next(){return this.endOfInput()?null:this.input[this.pointer++]}prev(){return this.pointer<=0?null:this.input[--this.pointer]}tokenizeUntil(t=","){var r=new Tokenizer(this.input);let a={type:"generic",value:""},n=!1;for(let e=this.next();null!==e;e=this.next())if(n||"text"==a.type&&e!=a.delimiter)a.value+=e,n=!1;else if("\\"===e)n=!0;else if("text"==a.type&&e==a.delimiter)this.pushSmart(r,a),a={type:"generic",value:""};else{if(e===t)break;e in this.blockChars?(this.pushSmart(r,a),r.push({type:"block",value:this.tokenizeUntil(this.blockChars[e]),start:e,end:this.blockChars[e]}),a={type:"generic",value:""}):this.quoteChars.includes(e)?(this.pushSmart(r,a),a={type:"text",value:"",delimiter:e}):"generic"==a.type&&this.hardSeparatorChars.includes(e)?(this.pushSmart(r,a),this.pushSmart(r,{type:"separator",value:e}),a={type:"generic",value:""}):"generic"==a.type&&this.softSeparatorChars.includes(e)?(this.pushSmart(r,a),a={type:"generic",value:""}):"operator"!==a.type&&this.operatorChars.includes(e)?(this.pushSmart(r,a),a={type:"operator",value:e}):"operator"!==a.type||this.operatorChars.includes(e)?a.value+=e:(this.pushSmart(r,a),a={type:"generic",value:""},this.prev())}return this.pushSmart(r,a),r}pushSmart(e,t){if("generic"==t.type){if(t.value=t.value.trim(),!t.value.length)return;isNaN(t.value)||(t.type="text",t.value=new Number(t.value))}e.push(t)}}function tokenize(e){e=new Tokenizer(e);return e.tokenize(),e}class Evaluator{vars;tokens;targetShortcuts={"@*":"attr",":*":"event",".*":"class","+":"html",".":"text","=":"value","?":"toggle","!":"remove"};operatorsCompare=["==","!=",">",">=","<","<="];operatorsBoolean=["!","&&","||"];data={negate:!1,condition:null,keyword:"",target:null,value:null};constructor(e){this.tokens=e,this.normalize()}normalize(){var e=Array.from(this.tokens);let t=this.nextToken(e,["operator","generic","block"]);if(0===e.length&&"debugger"===t.value)this.data.condition={type:"special",value:"debugger"},this.data.keyword="debugger";else{"operator"===t.type&&["!","!!"].includes(t.value)&&(this.data.negate=t.value.length,t=this.nextToken(e,["generic","block"])),this.data.condition=t;var r=(t=this.nextToken(e,["generic"])).value.substr(0,1)+(1<t.value.length?"*":"");if(void 0!==this.targetShortcuts[r])switch(this.data.keyword=this.targetShortcuts[r],this.data.keyword){case"attr":case"event":e.unshift({type:"block",value:[{type:"generic",value:t.value.substr(1)}]});break;case"class":e.unshift({type:"text",value:t.value.substr(1).replace(/\./g," ")})}else{if(!Object.values(this.targetShortcuts).includes(t.value))throw new Error(`Invalid keyword: ${t.value} . Supported keywords: `+Object.keys(this.targetShortcuts).join(", "));this.data.keyword=t.value}(t=this.nextToken(e,["block","text","generic",null]))&&("block"===t.type&&(this.data.target=t.value[0].value,t=this.nextToken(e,["text","generic",null])),t)&&("text"===t.type?this.data.value=t.value:"generic"===t.type&&(this.data.value=t))}}getVariableValue(e){return void 0!==this.vars[e]?this.vars[e]:null}evaluate(e){if("object"!=typeof e)throw new Error(`The variables must be an object. Current argument: ${typeof e}.`);this.vars=e;var t={...this.data};if("special"===t.condition.type)t.keyword=t.condition.value,t.condition=!0;else{switch(null===t.value&&"generic"==t.condition.type?t.value=this.toValue(t.condition,t.negate):"object"==typeof t.value&&(t.value=this.toValue(t.value,t.negate)),t.condition.type){case"block":t.condition=!!this.evaluateBlock(t.condition.value);break;case"generic":t.condition=!!this.evaluateVariable(t.condition.value)}1==t.negate&&(t.condition=!t.condition)}return t}evaluateVariable(e){e=this.getVariableValue(e);return null===e?null:this.isEmpty(e)}isEmpty(e){return!("object"==typeof e&&(e.constructor!==Object||0!==Object.keys(e).length)||Number.isFinite(e)&&0===e||!e)}evaluateBlock(tokens){const expression=this.mkExpression(tokens);return eval(expression)}mkExpression(e){let t="";for(;;){var r=this.nextToken(e,["generic","block","text","operator",null]);if(!r)break;if(1<e.length&&"operator"===e[0].type&&this.operatorsCompare.includes(e[0].value)){var a=this.nextToken(e,["operator"]),n=this.nextToken(e,["generic","text"]);t+=this.compare(r,a,n)?1:0}else switch(r.type){case"operator":if(!this.operatorsBoolean.includes(r.value))throw new Error(`Invalid operator: ${r.value}. Supported operators: `+this.operatorsBoolean.join(", "));t+=r.value;break;case"block":t+=this.mkExpression(r.value);break;case"generic":t+=this.evaluateVariable(r.value)?1:0;break;case"text":t+=this.isEmpty(r.value)?1:0}}return"("+(t||"0")+")"}toValue(e,t=0){let r;switch(e.type){case"generic":r=this.getVariableValue(e.value);break;case"text":r=e.value;break;case"block":r=this.evaluateBlock(e.value);break;default:throw new Error(`Invalid token type: ${e.type} (value: ${JSON.stringify(e)}).`)}if(null===r)return r;var a=Number(r);let n=isNaN(a)?r:a;for(let e=t;e;e--)n=!n;return n}compare(e,t,r){var a=this.toValue(e),n=this.toValue(r);switch(t.value){case"==":return a===n?1:0;case"!=":return a!==n?1:0;case"<":return a<n?1:0;case"<=":return a<=n?1:0;case">":return n<a?1:0;case">=":return n<=a?1:0;default:throw new Error(`Invalid operator: ${t.value} . Supported operators: `+this.operatorsCompare.join(", "))}}nextToken(e,t=[]){e=e.shift();if(t.includes(e?e.type:null))return e;throw new Error(`Invalid z-var value: (${e&&e.type}) "${e&&e.value}". Generic or block expected: "${this.tokens.input}"`)}}function evaluate(e,t){return new Evaluator(e).evaluate(t)}class Template{rootElement=null;vars=null;scopeLevel=0;scopeSelector="*[@template or (@template-scope and @template-scope != 'inherit')]";zElementSelector="*[@z-var]";scopeLevelSelector=`count(ancestor-or-self::${this.scopeSelector})`;constructor(e){if(!(e instanceof Element))throw new Error("DnaTemplate accepts an instance of HTMLElement as constructor argument");this.rootElement=e,this.scopeLevel=this.query(this.scopeLevelSelector,e)}render(e){this.vars=e;var t=this.query(`descendant-or-self::${this.zElementSelector}[${this.scopeLevelSelector} = ${this.scopeLevel}]`);console.log("found",t);for(let e=0;e<t.length;e++)this.processZElement(t[e])}processZElement(t){const r=t.getAttribute("z-var");var e=tokenize(r);Array.from(e).map(e=>evaluate(e,this.vars)).forEach(e=>{switch(console.log("zVar",e,r,t),e.keyword){case"debugger":break;case"attr":this.cmdAttr(t,e)}})}cmdAttr(e,t){null!==t.value&&void 0!==t.value&&(!0===t.value?e.setAttribute(t.target,t.target):!1===t.value?e.removeAttribute(t.target):e.setAttribute(t.target,t.value))}query(e,t=null){var r=this.rootElement.ownerDocument.evaluate(e,t||this.rootElement,null,XPathResult.ANY_TYPE,null);switch(r.resultType){case XPathResult.NUMBER_TYPE:return r.numberValue;case XPathResult.STRING_TYPE:return r.stringValue;case XPathResult.BOOLEAN_TYPE:return r.booleanValue;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:for(var a,n=[];a=r.iterateNext();n.push(a));return n}}}function dnaTemplate(e,t){return new Template(e instanceof Document?e.documentElement:e).render(t)}return dnaTemplate}(),"undefined"!=typeof jQuery&&(jQuery.fn.template=function(r){return this.each((e,t)=>dnaTemplate(t,r)),this});
//# sourceMappingURL=template.min.js.map