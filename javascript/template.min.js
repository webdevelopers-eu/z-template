/*! DNA Template | (c) Daniel Sevcik | MIT License | https://github.com/webdevelopers-eu/dna-template */
window.t=function(){class Tokenizer extends Array{i=["!","=","<",">","~","|","&"];l=["'",'"'];o={h:"}",u:"]",p:")"};v=[","];k=[" ","\t","\r","\n"];input;m=0;constructor(e){super(),this.input=(e||"")+""}g(){for(;!this.T();){var e=this.$();if(null===e)break;this.push(e)}}T(){return this.m>=this.input.length}next(){return this.T()?null:this.input[this.m++]}C(){return this.m<=0?null:this.input[--this.m]}$(t=","){var r=new Tokenizer(this.input);let s={type:"generic",value:""},a=!1;for(let e=this.next();null!==e;e=this.next())if(a||"text"==s.type&&e!=s.S)s.value+=e,a=!1;else if("\\"===e)a=!0;else if("text"==s.type&&e==s.S)this.j(r,s),s={type:"generic",value:""};else{if(e===t)break;e in this.o?(this.j(r,s),r.push({type:"block",value:this.$(this.o[e]),start:e,end:this.o[e]}),s={type:"generic",value:""}):this.l.includes(e)?(this.j(r,s),s={type:"text",value:"",S:e}):"generic"==s.type&&this.v.includes(e)?(this.j(r,s),this.j(r,{type:"separator",value:e}),s={type:"generic",value:""}):"generic"==s.type&&this.k.includes(e)?(this.j(r,s),s={type:"generic",value:""}):"operator"!==s.type&&this.i.includes(e)?(this.j(r,s),s={type:"operator",value:e}):"operator"!==s.type||this.i.includes(e)?s.value+=e:(this.j(r,s),s={type:"generic",value:""},this.C())}return this.j(r,s),r}j(e,t){if("generic"==t.type){if(t.value=t.value.trim(),!t.value.length)return;isNaN(t.value)||(t.type="text",t.value=new Number(t.value))}e.push(t)}}function tokenize(e){e=new Tokenizer(e);return e.g(),e}class Preparator{P;N;R={A:"attr",I:"event",V:"callback",O:"class",X:"html",B:"text",L:"value",q:"toggle",D:"remove"};H=["==","!=",">",">=","<","<="];G=["!","&&","||"];data={J:0,variable:null,value:null,M:null,action:"",U:null,Z:null};constructor(e,t){if("object"!=typeof t)throw new Error(`The variables must be an object. Current argument: ${typeof t}.`);this.P=t,this.N=e,this.normalize(),this.true=!0,this.false=!1,this.null=null,this[void 0]=void 0}normalize(){var t=Array.from(this.N);let r=this.F(t,["operator","generic","block"]);if(0===t.length&&"debugger"===r.value)this.data.value={type:"special",value:"debugger"},this.data.action="debugger";else{"operator"===r.type&&["!","!!"].includes(r.value)&&(this.data.J=r.value.length,r=this.F(t,["generic","block"])),"generic"===r.type?(this.data.value=this.P[r.value],this.data.variable=r.value):this.data.value=this.K(t);var s=(r=this.F(t,["generic","operator"])).value.substr(0,1)+(1<r.value.length?"*":"");if(void 0!==this.R[s])this.data.action=this.R[s],t.unshift({type:"text",value:r.value.substr(1),info:"Extracted from shortcut"});else{if(!Object.values(this.R).includes(r.value))throw new Error(`Invalid action: ${r.value} . Supported actions: `+Object.keys(this.R).join(", "));this.data.action=r.value}r=this.F(t,["text","generic",null]),this.data.U=r?.value;let e=0;"operator"===(r=this.F(t,["block","operator",null]))?.type&&["!","!!"].includes(r.value)&&(e=r.value.length,r=this.F(t,["block",null])),"block"===r?.type?(this.data.Z=this.K(r.value),r=this.F(t,["block",null])):this.data.Z=!0,this.data.W=this.Y(this.data.Z,e)}}getVariableValue(e){return void 0!==this.P[e]?this.P[e]:null}_(){var e={...this.data};if("special"===e.Z.type)e.action=e.Z.value,e.Z=!0;else switch(null===e.value&&"generic"==e.Z.type?e.value=this.ee(e.Z,e.J):e.value="object"==typeof e.value?this.ee(e.value,e.J):this.Y(e.value,e.J),e.M=this.te(e.value),e.Z.type){case"block":e.Z=!!this.K(e.Z.value);break;case"generic":e.Z=!!this.re(e.Z.value)}return e}re(e){e=this.getVariableValue(e);return null===e?null:this.te(e)}te(e){switch(typeof e){case"string":return 0!==e.length;case"object":return null!==e&&0!==Object.keys(e).length;case"number":return 0!==e;case"boolean":return e;default:return!1}}K(tokens){const expression=this.se(tokens);return eval(expression)}se(e){let t="";for(;;){var r=this.F(e,["generic","block","text","operator",null]);if(!r)break;if(1<e.length&&"operator"===e[0].type&&this.H.includes(e[0].value)){var s=this.F(e,["operator"]),a=this.F(e,["generic","text"]);t+=this.compare(r,s,a)?1:0}else switch(r.type){case"operator":if(!this.G.includes(r.value))throw new Error(`Invalid operator: ${r.value}. Supported operators: `+this.G.join(", "));t+=r.value;break;case"block":t+=this.se(r.value);break;case"generic":t+=this.re(r.value)?1:0;break;case"text":t+=this.te(r.value)?1:0}}return"("+(t||"0")+")"}ee(e,t=0){let r;switch(e.type){case"generic":r=this.getVariableValue(e.value);break;case"text":r=e.value;break;case"block":r=this.K(e.value);break;default:throw new Error(`Invalid token type: ${e.type} (value: ${JSON.stringify(e)}).`)}var s;return null===r?r:(s=Number(r),s=isNaN(s)?r:s,this.Y(s,t))}compare(e,t,r){var s=this.ee(e),a=this.ee(r);switch(t.value){case"==":return s===a?1:0;case"!=":return s!==a?1:0;case"<":return s<a?1:0;case"<=":return s<=a?1:0;case">":return a<s?1:0;case">=":return a<=s?1:0;default:throw new Error(`Invalid operator: ${t.value} . Supported operators: `+this.H.join(", "))}}F(e,t=[]){e=e.shift();if(t.includes(e?e.type:null))return e;throw new Error(`Invalid z-var value: (${e&&e.type}) "${e&&e.value}". Generic or block expected: "${this.N.input}"`)}Y(t,r=0){for(let e=r;e;e--)t=!t;return t}}function prepare(e,t){return new Preparator(e,t)._()}class Template{rootElement=null;P=null;ae={};ie=0;ne="*[@template or (@template-scope and @template-scope != 'inherit')]";le="*[@z-var]";oe=`count(ancestor-or-self::${this.ne})`;constructor(e){if(!(e instanceof Element))throw new Error("DnaTemplate accepts an instance of HTMLElement as constructor argument");this.rootElement=e,this.ie=this.query(this.oe,e)}ce(e,t){this.P=e,this.ae=t;var r=this.query(`descendant-or-self::${this.le}[${this.oe} = ${this.ie}]`);for(let e=0;e<r.length;e++)this.he(r[e])}he(t){var e=tokenize(t.getAttribute("z-var")),e=Array.from(e).map(e=>prepare(e,this.P));const r=[],s=this.ue(t);e.forEach(e=>{if(e.Z)switch(e.action){case"attr":this.pe(s,e);break;case"text":this.ve(s,e);break;case"html":this.be(s,e);break;case"value":this.de(s,e);break;case"class":this.fe(s,e);break;case"toggle":this.ke(s,e);break;case"debugger":break;case"remove":case"event":case"callback":r.push(e)}}),this.me(t,s),r.forEach(e=>{if(null!==t.parentNode)switch(e.action){case"remove":this.ge(t,e);break;case"event":this.we(t,e);break;case"callback":this.ye(t,e)}})}ye(e,t){var r=this.ae[t.U];if("function"!=typeof r)throw new Error(`Callback ${t.U} is not defined`);r(e,t.value)}we(e,t){t=new CustomEvent(t.U,{detail:t.value,bubbles:!0,cancelable:!0,composed:!1});e.dispatchEvent(t)}ge(e,t){t.M&&e.remove()}ke(e,t){t.M?(e.classList.add("dna-template-visible"),e.classList.remove("dna-template-hidden")):(e.classList.add("dna-template-hidden"),e.classList.remove("dna-template-visible"))}fe(r,s){s.U.trim().split(/[ ,.]+/).forEach(e=>{let t=s.M;"!"===e.substr(0,1)&&(t=!t,e=e.substr(1)),t?r.classList.add(e):r.classList.remove(e)})}de(e,t){e.matches('input[type="checkbox"], input[type="radio"]')?("boolean"==typeof t.value?t.value:e.value===t.value)?e.setAttribute("checked","checked"):e.removeAttribute("checked"):e.matches("input")?e.setAttribute("value",t.value):e.matches("select")?Array.from(e).filter(e=>e.value===t.value).forEach(e=>e.setAttribute("selected","selected")):e.matches("textarea")?e.textContent=t.value:e.setAttribute("value",t.value)}be(e,t){e.innerHTML=t.value}ve(e,t){e.textContent=this.xe(e,e.textContent,t.variable,t.value||"","")}pe(e,t){var r;!0===t.value?e.setAttribute(t.U,t.U):!1===t.value?e.removeAttribute(t.U):(r=this.xe(e,e.getAttribute(t.U),t.variable,t.value,t.U),e.setAttribute(t.U,r))}xe(e,t,r,s,a=""){var i="${"+r+"}",a="z-var-content"+(a?"-"+a:"");let n;return n=r&&t&&-1!==t.indexOf(i)?(t||"").replace(i,s):s,t!==n&&t&&!e.hasAttribute(a)&&e.setAttribute(a,t),n}me(t,r){t.innerHTML!==r.innerHTML&&(t.innerHTML=r.innerHTML);for(let e=0;e<r.attributes.length;e++){var s=r.attributes[e];t.getAttribute(s.name)!==s.value&&t.setAttribute(s.name,s.value)}for(let e=0;e<t.attributes.length;e++){var a=t.attributes[e];r.hasAttribute(a.name)||t.removeAttribute(a.name)}}ue(e){const r=e.cloneNode(!0);Array.from(e.attributes).filter(e=>{var t=e.name.replace(/^z-var-content-?/,"");t?r.setAttribute(t,e.value):r.textContent=e.value});return r}query(e,t=null){var r=this.rootElement.ownerDocument.evaluate(e,t||this.rootElement,null,XPathResult.ANY_TYPE,null);switch(r.resultType){case XPathResult.NUMBER_TYPE:return r.numberValue;case XPathResult.STRING_TYPE:return r.stringValue;case XPathResult.BOOLEAN_TYPE:return r.booleanValue;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:for(var s,a=[];s=r.iterateNext();a.push(s));return a;default:return null}}}function dnaTemplate(e,t,r={}){return new Template(e instanceof Document?e.documentElement:e).ce(t,r||{})}return dnaTemplate}(),"undefined"!=typeof jQuery&&(jQuery.fn.Ee=function(r){return this.each((e,t)=>dnaTemplate(t,r)),this});
//# sourceMappingURL=template.min.js.map