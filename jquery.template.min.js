/*! Javascript Lazy Template | MIT License | (c) Daniel Ševčík | www.webdevelopers.eu */
$.fn.template=function(a,b){function c(a,b){function c(a,b,c){var d;return d="string"==typeof a&&a.match("(\\$\\{|%24%7B)"+b+"(\\}|%7D)")?a.replace(new RegExp("\\$\\{"+b+"\\}","g"),c).replace(new RegExp("%24%7B"+b+"%7D","g"),c):c,d}function d(a,b,c,d){if(d[c])return b;d[c]=!0;var e=a.data("template:"+c);return"string"==typeof e?e:(a.data("template:"+c,b),b)}if("object"!=typeof a)throw console.log("replaceVars: Cannot replace variables inside the context",a,b),new Error("Cannot replace HTML variables.");var e=b.find("*[template^=\"[\"] *[template^=\"[\"], *[template^=\"{\"] *[template^=\"[\"], *[template^=\"[\"] *[template^=\"{\"], *[template^=\"{\"] *[template^=\"{\"]"),f=b.find("*[template^=\"[\"], *[template^=\"{\"]").not(e),g=$.map(a,function(a,b){return"*[z-var*=\""+b+" \"]"}).join(", ");return b.find(g).not(f.find(g).add(f)).add(b.filter(g)).not(b.find("*[template-scope] *[z-var]")).each(function(b,e){var f={},g=null,h=[],i={},j=$(e),k=$.trim(j.attr("z-var")).split(",");for(let l,m=0;m<k.length;m++){if(l=$.trim(k[m]).split(/\s+/),"debugger"==l[0]){debugger;continue}let b,e;"!"==l[0].substr(0,1)?(e=l[0].substr(1),b=!0):(e=l[0],b=!1);let n=a[e];if(null==typeof n)continue;let o=l[1]||".",p=!("object"==typeof n&&$.isEmptyObject(n))&&(!$.isNumeric(n)||parseFloat(n))&&n;p=b?!p:!!p;let q=$.type(n).match(/string|number/)?n:"";if($.isArray(n)&&(q=n.length),"?"==o)g=(null===g||g)&&p;else if("!"==o)p||j.remove();else if("."==o)j.text(c(d(j,j.text(),o,f),e,q));else if("+"==o)j.get(0).innerHTML=$("<div></div>").html(n).html();else if("="==o)j.is(":checkbox, :radio")?j.prop("checked",$.type(n).match(/string|number/)?j.val()==q:p):j.val(n);else if(":"==o.substr(0,1))p&&h.push(o.substr(1));else if("."==o.substr(0,1)){let a=o.substr(1).replace("."," ");p?(i[o]=!0,j.addClass(a)):!i[o]&&(i[o]=!0,j.removeClass(a))}else"@"==o.substr(0,1)?"boolean"==$.type(n)?j.attr(o.substr(1),p?o.substr(1):null):j.attr(o.substr(1),c(d(j,j.attr(o.substr(1)),o,f),e,q)):console.log("Error: replaceVars(): invalid target \""+o+"\" for variable \""+e+"\" in \""+j.attr("z-var")+"\"")}null!==g&&($(e).toggleClass("dna-template-visible",g).toggleClass("dna-template-hidden",!g),g&&"none"==e.style.display&&$(e).css("display","")),h.forEach(function(b){j.trigger(b,[a])})}),f.each(function(){var b=$(this),c=b.attr("template").match(/^([{\[])(.*)[\]}]$/),d="{"==c[1],e=c[2],f=a[e];if("undefined"!=typeof f&&null!==f)if(b.siblings("[template-clone]").filter(function(){return $(this).attr("template-clone")==b.attr("template")}).remove(),d)"object"!=$.type(f)&&(f={value:f}),b.template(f,!1);else switch($.isEmptyObject(f)&&(f=[]),$.type(f)){case"string":case"number":case"bool":case"object":f=[f];case"array":$.each(f,function(a,c){b.template($.isPlainObject(c)?c:{value:c})});}}),b}var d=$();if($(this).add(d).trigger("template:before",[a,this,d,b]),$.isArray(a))for(var e=0;e<a.length;e++)d.add($(this).template(a[e],b));else this.each(function(){var e=$(this),f="boolean"==typeof b?b:!e.is("[template]"),g=f?e:e.clone().addClass("template-clone").attr("template-clone",e.attr("template")).insertBefore(this),h=c(a,g).removeAttr("template");d=d.add(h)});return $(this).add(d).trigger("template:after",[a,this,d,b]),d};
